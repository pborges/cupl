# cupl

**WARNING** This compiler was developed entirely through blackbox testing — comparing input `.pld` files against expected `.jed` output files. It has not been validated against the WinCUPL source or specification beyond these test cases and may not be ready for production use.

A minimal, cross-platform CLI to compile WinCUPL `.pld` files into JEDEC (`.jed`) programming files for PAL/GAL devices.

WinCUPL is Windows-only and long out of date. This project aims to provide a modern replacement focused on:

- A **small, dependency-light** Go codebase
- A **clean CLI** for batch-friendly workflows
- **Deterministic output** suitable for programming PAL/GAL devices

## Status

Working MVP:

- Parses a practical CUPL subset
- Supports `g16v8` and `g22v10`
- Generates JEDEC with checksums
- Quine-McCluskey product term minimization
- Blackbox tested against real-world PLD/JED samples

## Limitations

- Not full WinCUPL parity yet
- Focused on logic equations used in the sample designs
- Limited device support (GAL16V8/22V10 variants only)

## Features

- WinCUPL-style `.pld` input to JEDEC `.jed` output
- Deterministic JEDEC generation with checksums
- Device support: `g16v8`, `g22v10`
- All three GAL16V8 modes: Simple, Complex, and Registered
- GAL22V10 registered outputs with global AR/SP
- Batch-friendly CLI (`build`, `burn`, `devices`, `version`, `-v`)
- Blackbox tested against real-world PLD/JED samples
- Small, dependency-light Go codebase

## Device Modes

### GAL16V8

The GAL16V8 supports three operating modes, auto-detected from equations:

| Mode | SYN | AC0 | Description |
|------|-----|-----|-------------|
| Simple | 1 | 0 | Pure combinatorial. Pin 1 and 11 are inputs. All 8 product terms available per output. |
| Complex | 1 | 1 | Combinatorial with programmable output enable. Row 0 of each OLMC is the OE equation. Pins 15/16 can be used as inputs. |
| Registered | 0 | 1 | Clocked registers. Pin 1 is clock, pin 11 is global /OE. Use `.R` extension on outputs. |

Mode is auto-detected but can be forced with device mnemonics:

- `g16v8as` — force Simple mode
- `g16v8ma` — force Complex mode
- `g16v8ms` — force Registered mode

### GAL22V10

Each OLMC is independently combinatorial or registered. Row 0 of each OLMC is always the tristate/OE term. Pin 1 is clock for registered outputs.

### Extensions

| Extension | Meaning |
|-----------|---------|
| `.R` | Registered output (clocked D flip-flop) |
| `.T` | Tristate data output |
| `.E` | Output enable equation |

### Global Signals (GAL22V10)

- `AR` — Asynchronous Reset (all registered outputs)
- `SP` — Synchronous Preset (all registered outputs)

### Examples

```
/* Registered output */
Q0.R = D0 & EN;

/* Combinatorial with tristate */
O0.T = I0 & I1;
O0.E = EN;

/* Inverted registered output */
!Q1.R = A & B;

/* Global async reset and sync preset */
AR = RESET;
SP = PRESET;
```

## Non-goals (initially)

- GUI tooling
- IDE integration
- Full WinCUPL feature parity on day one

## CLI

```bash
# Compile PLD into JEDEC
cupl build path/to/design.pld -o path/to/design.jed

# Burn JEDEC to device with minipro (device auto-detected from JED header)
cupl burn path/to/design.jed

# Or burn directly from a PLD (builds a temp JED first)
cupl burn path/to/design.pld

# Override minipro device name
cupl burn path/to/design.jed -p g16v8as

# Show device info or list supported devices
cupl devices

# Show version
cupl -v
```

## Build And Test

```bash
go build ./cmd/cupl
go test ./...
```

## References

- CUPL Programmer’s Guide: https://ece-classes.usc.edu/ee459/library/documents/CUPL_Reference.pdf
- `galette` (Rust GAL assembler): https://github.com/simon-frankau/galette
- `GALasm` (older GAL assembler): https://github.com/daveho/GALasm

## Samples

Test fixtures included in `examples/`.

The original PLD source files are courtesy of [digicoolthings.com](https://digicoolthings.com/) and have been renamed for brevity. The `.jed` files were regenerated by this compiler using Quine-McCluskey minimization and may differ from the originals.

- `MECB_32K_RAM_32K_ROM` — GAL16V8, 32K RAM / 32K ROM
- `MECB_48K_RAM_16K_ROM` — GAL16V8, 48K RAM / 16K ROM
- `MECB_56K_RAM_8K_ROM` — GAL16V8, 56K RAM / 8K ROM
- `MECB_C_4K_RAM_32K_ROM_OB` — GAL16V8, CreatiVision 4K RAM / 32K ROM onboard
- `MECB_C_4K_RAM_Exp_ROM` — GAL16V8, CreatiVision 4K RAM / expansion ROM
- `MECB_P_22V10` — GAL22V10, prototype chip select
- `MECB_P_0xA000_0xAFFF` — GAL22V10, prototype 0xA000–0xAFFF
- `MECB_P_IO_0xE0_0xFF` — GAL22V10, prototype I/O 0xE0–0xFF

## License

TBD
